# 楼梯组件动画详细实现方案

## 基本楼梯结构动画

### 楼梯生成动画
- **动画时长**：根据n值动态调整，总时长为2秒
- **动画流程**：
  1. **初始状态**（0-0.3秒）：
     - 画布中心显示一个平台（起点，第0阶）
     - 起点平台使用浅灰色(#E0E0E0)，带有细微的纹理（如木纹或石纹）
     - 从完全透明(opacity: 0)到完全不透明(opacity: 1)的渐变效果
     - 平台出现时有轻微的"落地"震动效果，配合低沉的落地音效
     - 添加初始化粒子爆发效果，象征算法启动
     - 地面产生细微波纹扩散动画，增强物理感
  
  2. **阶梯出现**（0.3-2秒）：
     - 每个阶梯的出现时间 = 1.7秒 ÷ n（确保总时间不超过2秒）
     - 阶梯从底部向上依次出现（0→1→2→...→n）
     - 每个阶梯出现时的特效：从下方20px位置以custom-spring物理缓动曲线滑入
     - 同时透明度从0变为1
     - 每个阶梯出现时有弹性物理效果(transform: scale(1.05, 0.95) 然后经过3-4次阻尼振荡回到 scale(1, 1))
     - 每级台阶出现时播放递增音调的简短音效（可选关闭）
     - 阶梯表面有动态光泽效果，随视角变化而变化
     - 添加"微尘"粒子系统，在阶梯出现时短暂漂浮
     - 阶梯出现时产生轻微的环境光变化，提升整体氛围
     - 使用流体动力学模拟，营造阶梯"从液态凝固"的效果

- **视觉参数**：
  - 阶梯高度（根据n值调整）：
    * n ≤ 5: 40px
    * 6 ≤ n ≤ 10: 30px
    * n > 10: 20px
  - 阶梯宽度（根据n值调整）：
    * n ≤ 5: 160px
    * 6 ≤ n ≤ 10: 140px
    * n > 10: 120px
  - 阶梯厚度：高度的1/4
  - 阶梯间距：垂直方向10px
  - 阶梯材质：可选多种材质风格（木质、大理石、金属、未来科技风等）
  - 材质动态属性：
    * 木质：细微的木纹纹理，轻微凹凸贴图，温暖的漫反射
    * 大理石：高光泽度，随机纹理图案，细微的反射效果
    * 金属：高反射率，冷色调环境映射，精细的划痕细节
    * 未来科技风：内部发光边缘，脉冲式亮度变化，半透明效果

- **3D效果实现**：
  - 使用真实的PBR材质和基于物理的光照系统
  - 使用CSS transform属性创建3D透视：perspective(800px) rotateX(25deg)
  - 动态光源：主光源从右上方45°角照射，强度适中，产生自然阴影
  - 环境光：柔和的背景环境光，提供基础照明
  - 阶梯正面：使用带有法线贴图的纹理，增强表面细节
  - 阶梯顶面：比正面亮20%的颜色，有微弱的反光效果
  - 阶梯侧面：比正面暗20%的颜色，有适当的AO(环境光遮蔽)效果
  - 光照效果：顶面添加反射高光和内部阴影box-shadow: inset 0px 2px 5px rgba(255,255,255,0.3)
  - 阴影效果：下方添加软阴影box-shadow: 0px 5px 15px rgba(0,0,0,0.2)，随阶梯位置变化
  - 视角控制：允许用户适度调整视角（±15°范围内），以便观察不同角度
  - 高级光照效果：
    * 体积光渲染，在关键台阶周围产生"光束"效果
    * 局部反射探针，使金属和光滑表面能反射周围环境
    * 动态阴影投射，随光源和视角变化
    * 屏幕空间环境光遮蔽(SSAO)效果，增强边缘和凹陷处细节
  - 物理材质系统：
    * 为每种材质定义粗糙度、金属度、反照率等PBR参数
    * 支持次表面散射效果，使半透明材质更真实
    * 提供法线贴图和位移贴图，增强表面微观细节
    * 实现磨损和划痕系统，让材质历时增添历史感
  - 交互式视角控制：
    * 鼠标拖拽可在限定范围内旋转查看台阶
    * 鼠标滚轮控制缩放级别（最大缩放500%）
    * 支持轻扫手势，引发"观察模式"的场景旋转

- **编号显示动画**：
  - 每个阶梯左侧显示数字标签
  - 标签出现时机：与对应阶梯同步出现，但有50ms的延迟
  - 出现动画：从透明到不透明渐变(300ms)，使用弹性缓动
  - 同时有弹性放大效果(scale: 0.7 → 1.1 → 1)
  - 样式：字体Roboto, 14px，白色(#FFFFFF)，带1-2px黑色(#000000)发光文字轮廓
  - 悬浮效果：编号微微悬浮在阶梯表面，有细微的上下浮动动画
  - 聚焦状态：当该阶梯被聚焦时，编号放大并增强发光效果
  - 增强编号效果：
    * 3D立体数字，有深度和投影
    * 数字周围细微的光粒子环绕
    * 根据算法进度变化颜色和发光强度
    * 支持悬停时的信息气泡展示（显示该阶详细信息）
    * 根据重要性动态调整大小（关键节点编号更大）
  - 编号交互响应：
    * 点击编号可锁定聚焦于该台阶
    * 双击编号触发该台阶的详细解释面板
    * 右键提供快捷菜单（跳至该阶、标记该阶等）

- **目标标识动画**：
  - 在第n阶顶部中央显示一个动态五角星图标
  - 出现时机：在所有阶梯出现后(2秒时)
  - 出现动画：星星从上方降落并放大(scale: 0 → 1.3 → 1)，同时旋转180度，持续0.5秒
  - 落地效果：落到最顶阶时产生小型"冲击波"涟漪动画
  - 持续效果：轻微的3D旋转效果(rotateY: -5deg ↔ 5deg，周期3秒)和脉动效果(scale: 1 ↔ 1.1，周期2秒)
  - 粒子效果：星星周围有微小的光粒子环绕飘动
  - 颜色：金色(#FFD700)，带黄色辐射光晕(box-shadow: 0 0 20px #FFC107)
  - 互动效果：鼠标悬停时星星旋转速度加快，光晕增强
  - 高级目标标识效果：
    * 多层次粒子系统，形成螺旋上升的"能量柱"
    * 周期性能量波纹向四周扩散
    * 与用户进度同步的填充/完成度动画
    * 气流模拟效果，使周围空气产生扭曲
    * 音频响应动画，星星随背景音乐节奏脉动
  - 互动增强：
    * 点击星星触发"目标预览"动画
    * 长按可查看当前任务完成百分比
    * 支持拖拽至其他台阶，动态改变目标

### 楼梯状态变化动画

- **未计算状态**：
  - 颜色：浅灰色(#E0E0E0)
  - 纹理：低对比度的细纹理
  - 透明度：70%
  - 光泽：无光泽效果（哑光表面）
  - 粒子效果：无
  - CSS实现：
    ```css
    .stair-uncalculated {
      background-color: #E0E0E0;
      opacity: 0.7;
      box-shadow: none;
      filter: saturate(0.5);
    }
    ```
  - 增强未计算状态：
    * 表面细微的"疑问波纹"动画
    * 雾化效果，给人未知感
    * 动态的灰度梯度，暗示潜在信息
    * 低能量状态的细微闪烁
    * 磁场线式细微纹理流动

- **已计算状态**：
  - 颜色：绿色(#81C784)
  - 纹理：清晰的材质纹理
  - 透明度：100%
  - 光泽：有光泽效果（反光表面）
  - 粒子效果：偶尔有小型绿色粒子从表面飘起
  - CSS实现：
    ```css
    .stair-calculated {
      background-color: #81C784;
      opacity: 1;
      box-shadow: 0 0 10px rgba(129, 199, 132, 0.5);
      filter: saturate(1.2);
    }
    ```
  - 增强已计算状态：
    * 能量稳定流动的回路纹理
    * 表面"数据流"动画，暗示计算完成
    * 定期释放的"确认光波"，清晰标识已计算
    * 增强表面材质的金属感和反光度
    * 内部隐约可见的"数据结构"全息图
    * 外边缘细微发光，强化台阶完成状态
    * 动态响应系统，当相邻台阶计算时产生共振

- **当前计算状态**：
  - 颜色：亮绿色(#4CAF50)
  - 纹理：增强的高对比度纹理
  - 透明度：100%
  - 边缘：发光效果，3px宽，颜色#A5D6A7，脉动变化(opacity: 0.7 ↔ 1.0)
  - 光泽：强光泽效果（高亮表面），有动态光流效果
  - 粒子效果：持续有绿色能量粒子围绕
  - 阴影：动态投影，随计算进度变化
  - CSS实现：
    ```css
    .stair-current {
      background-color: #4CAF50;
      opacity: 1;
      box-shadow: 0 0 15px #A5D6A7;
      border: 3px solid #A5D6A7;
      filter: saturate(1.5) brightness(1.1);
      animation: pulseBorder 1.5s infinite;
    }
    
    @keyframes pulseBorder {
      0%, 100% { border-color: rgba(165, 214, 167, 0.7); }
      50% { border-color: rgba(165, 214, 167, 1); }
    }
    ```
  - 增强当前计算状态：
    * 动态计算可视化系统，显示实时"思考过程"
    * 算法数据流体动画，展示计算运行状态
    * 动态闪电/能量连接线，连向依赖台阶
    * 脉冲光波从中心向边缘扩散，节奏与算法步骤同步
    * 表面活跃的"神经网络"动画，模拟计算进行
    * 动态反重力悬浮效果，表示特殊状态
    * 立体声定位音效，跟随计算进度变化
    * 环境光响应，照亮当前计算区域
    * 微弱的三维全息数字显示，浮于台阶表面

- **状态转换动画**：
  - 从未计算到当前计算：
    * 颜色变化：#E0E0E0 → #4CAF50，使用弹性缓动，持续400ms
    * 透明度：0.7 → 1，持续300ms
    * 发光效果：0 → 100%，使用弹性缓动，持续400ms，延迟100ms开始
    * 脉冲光波：从中心向边缘扩散的环形波动效果
    * 粒子爆发：转换瞬间产生小范围的粒子爆发
    * 音效：轻柔的"激活"音效（可选）
    * 缓动函数：custom-elastic (弹性缓动)
    * 物质态变化效果：从"固态"到"能量态"的视觉转变
    * 重力场扭曲效果：短暂的周围空间扭曲动画
    * 数据结构具象化：抽象数据点从台阶内部浮现
    * 触媒反应动画：从接触点扩散的变化效果
  
  - 从当前计算到已计算：
    * 颜色变化：#4CAF50 → #81C784，持续400ms
    * 发光效果：100% → 50%，持续300ms
    * 边缘光芒：从边缘向中心收缩
    * 粒子效果：粒子逐渐减少并消失
    * 结果固定效果：轻微的"锁定"振动和闪光
    * 音效：柔和的"完成"音效（可选）
    * 缓动函数：custom-bounce-out
    * 稳定化动画：从活跃状态过渡到静态平衡状态
    * 数据融合效果：计算数据与台阶结构融合
    * 能量场稳定化：从动态波动变为稳定辐射
    * 完成印记：表面出现细微的永久"完成标记"纹理
  
  - 动画协调：使用GSAP或Framer Motion实现精确的物理动画效果和时序控制
  - 转场效果：状态间平滑过渡，避免生硬切换
  - 高级状态过渡系统：
    * 支持部分计算状态（25%、50%、75%进度视觉区分）
    * 相邻台阶间的连锁反应效果
    * 实现反转状态动画，支持后退和重置
    * 转换过程中的速度变化根据算法复杂度自动调整
    * 错误状态特效（计算出错或需修正时）

## 方法数显示器动画

### 显示器基本设计
- **外观参数**：
  - 形状：圆形计数器，直径30px，可根据数字大小动态调整
  - 边框：双层设计，内层2px solid #616161，外层1px solid #FFFFFF
  - 圆角：50%（完全圆形）
  - 位置：每个阶梯右上角，内边距为阶梯宽度的5%
  - 垂直偏移：向上-15px（使其略微悬浮在阶梯上方）
  - 阴影：多层阴影效果，内部纹理阴影+外部投影阴影
  - 发光效果：轻微的背景发光，强调其重要性
  - 高级显示器设计：
    * 半透明玻璃态材质，带有内部光反射
    * 动态表面张力效果，模拟液态金属表面
    * 3D凸起效果，使用CSS径向渐变和阴影实现
    * 精细刻度环，环绕显示器边缘，暗示数值范围
    * 微小的背景纹理，如电路板或算法符号图案
    * 内部动态光照效果，随数值大小变化

- **未计算状态设计**：
  - 背景：动态渐变浅灰色(#F5F5F5 → #E0E0E0)，周期5秒
  - 文字："?"，灰色(#9E9E9E)
  - 字体：Roboto Mono，16px
  - 脉动效果：微弱的尺寸脉动(scale: 0.95 ↔ 1.0)，表示"等待计算"
  - 悬浮状态：鼠标悬停时显示"未计算"的提示文字
  - CSS实现：
    ```css
    .counter-uncalculated {
      background: linear-gradient(45deg, #F5F5F5, #E0E0E0, #F5F5F5);
      background-size: 200% 200%;
      animation: gradientShift 5s ease infinite;
      color: #9E9E9E;
      display: flex;
      justify-content: center;
      align-items: center;
      font-family: 'Roboto Mono', monospace;
      font-size: 16px;
      box-shadow: inset 0 0 5px rgba(0,0,0,0.1), 0 2px 4px rgba(0,0,0,0.2);
    }
    
    @keyframes gradientShift {
      0%, 100% { background-position: 0% 0%; }
      50% { background-position: 100% 100%; }
    }
    ```
  - 增强未计算状态：
    * 问号立体化，带有3D旋转效果
    * 模糊边缘效果，暗示不确定性
    * 隐约可见的空格/占位符，预示将填入的数值
    * "思考中"的波纹动画，暗示等待计算
    * 交互提示微动画，鼓励用户预测结果

- **已计算状态设计**：
  - 背景：浅绿色(#E8F5E9)，带有微弱的放射状渐变
  - 边框：细微的绿色发光边框
  - 文字：深灰色(#212121)，有细微的浮雕效果
  - 字体：Roboto Mono，16px
  - 大数值处理：
    * 1-2位数：16px字体
    * 3位数：14px字体
    * 4位数及以上：使用科学计数法，12px字体
  - 悬浮效果：鼠标悬停时轻微放大并显示完整数值
  - 粒子效果：数值稳定后偶尔有微小绿色粒子飘出
  - CSS实现：
    ```css
    .counter-calculated {
      background: radial-gradient(circle, #E8F5E9 60%, #C8E6C9 100%);
      color: #212121;
      text-shadow: 0 1px 0 rgba(255,255,255,0.5);
      box-shadow: 0 0 5px rgba(76, 175, 80, 0.3), inset 0 0 3px rgba(255,255,255,0.8);
      transition: all 0.3s ease;
    }
    .counter-calculated:hover {
      transform: scale(1.1);
      box-shadow: 0 0 8px rgba(76, 175, 80, 0.5), inset 0 0 3px rgba(255,255,255,0.8);
    }
    .counter-value-large {
      font-size: 14px;
    }
    .counter-value-xlarge {
      font-size: 12px;
    }
    ```
  - 增强已计算状态：
    * 数值3D效果，有深度感和阴影
    * 背景微妙的数学符号或模式动画
    * 内部"数据流"效果，数字周围有数据运动痕迹
    * 高精度视觉表现，使用抗锯齿和亚像素渲染
    * 多层次视觉设计，创造深度和立体感
    * 交互式数值展示，支持点击查看计算过程
    * 数值比较功能，悬停时显示与相邻台阶的对比

### 显示器动画效果

- **初始化动画**：
  - 出现时机：与对应阶梯同步出现，但有100ms延迟
  - 出现效果：从透明到不透明渐变(250ms)
  - 缩放效果：从scale(0.5)到scale(1.1)再到scale(1)，使用弹性缓动
  - 旋转效果：轻微的clockwise旋转(0° → 20° → 0°)
  - 光晕效果：短暂的白色光晕闪烁，强调其出现
  - 增强初始化效果：
    * 显示器零件组装动画，模拟部件构建过程
    * 系统启动序列，显示微型"加载进度条"
    * 全息投影显示器出现效果，从光点扩展成形
    * 入场声音效果，提升存在感
    * 初始随机数值闪烁，最终稳定为"?"

- **计算中动画**：
  - 触发时机：当前阶梯开始计算时
  - 问号动画：问号有轻微晃动效果，表示"正在思考"
  - 轮廓闪烁：边框颜色闪烁(#9E9E9E ↔ #4CAF50)，表示处理中
  - 背景效果：背景有流动光效，类似进度指示
  - 脉动光环：环形光波从中心向外扩散，周期1秒
  - 实现方式：使用CSS animation和SVG滤镜
  - 增强计算中效果：
    * 数据处理可视化，显示微型"计算图形"
    * 内部数字快速滚动效果，类似密码破解
    * 渐进式加载动画，精确显示计算进度
    * 动态能量流入效果，展示数据从依赖节点流入
    * "计算力"视觉表现，环绕显示器的能量云
    * 声音反馈系统，处理复杂计算时发出不同音调

- **值更新动画**：
  - 计数效果：从0逐步递增到目标值，使用物理阻尼效果
  - 数字变换：数字翻转效果，类似机械计数器
  - 每步更新时间：目标值 ≤ 10时为80ms/步，大于10时按比例缩短
  - 减速效果：接近最终值时逐渐减速，模拟惯性
  - 最小步长：1（整数值）或0.1（小数值）
  - 背景变化：同时从灰色(#F5F5F5)过渡到绿色(#E8F5E9)，有径向扩散效果
  - 完成效果：到达最终值时有短暂的放大强调和闪光
  - JavaScript实现（使用GSAP）：
    ```javascript
    function animateValue(element, start, end, duration) {
      // 计算步长，确保动画平滑
      const range = end - start;
      const minStep = range > 100 ? 1 : 0.1;
      
      // 设置GSAP动画，使用弹性缓动
      gsap.to({ value: start }, {
        value: end,
        duration: duration / 1000,
        ease: "power2.out",
        onUpdate: function() {
          // 四舍五入到适当的小数位
          const value = Math.round(this.targets()[0].value / minStep) * minStep;
          element.textContent = value.toLocaleString();
        },
        onComplete: function() {
          // 完成时的额外动画效果
          gsap.to(element, {
            scale: 1.2,
            duration: 0.1,
            yoyo: true,
            repeat: 1,
            ease: "power2.inOut",
            onComplete: function() {
              // 添加完成后的稳定状态特效
              element.classList.add('counter-completed');
            }
          });
        }
      });
      
      // 背景色变化动画
      gsap.to(element.parentNode, {
        backgroundColor: "#E8F5E9",
        boxShadow: "0 0 10px rgba(76, 175, 80, 0.3)",
        duration: duration / 1000,
        ease: "power1.inOut"
      });
    }
    ```

- **特殊状态效果**：
  - 溢出处理：当值超过预期范围时，显示器短暂变红后自动扩展
  - 重要值标记：特定值（如斐波那契数）有特殊的视觉处理
  - 比较状态：在比较不同方法时，相同结果会同步高亮
  - 错误状态：计算错误时有红色闪烁和震动效果
  - 重置效果：值重置时有"倒带"动画效果，迅速回到初始状态

- **交互反馈效果**：
  - 点击响应：点击显示器可查看详细计算过程
  - 悬停信息：悬停时显示工具提示，包含额外信息
  - 长按操作：长按可手动修改值（教学模式）
  - 连接线：在必要时显示与其他显示器的关系连线
  - 历史轨迹：可选显示值的变化历史，类似股票图表 